<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Smart Aptitude Quiz</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<style>
:root {
  --primary:#7c7cff;
  --bg:radial-gradient(1200px 600px at 10% 10%, #1b2a4e, #0f172a);
  --card:rgba(255,255,255,0.92);
  --ok:#22c55e;
  --bad:#ef4444;
  --quant:#3b82f6;
  --logic:#f59e0b;
  --di:#10b981;
}
*{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
body{margin:0;min-height:100vh;background:var(--bg);display:grid;place-items:center}
.card{width:95%;max-width:820px;background:var(--card);border-radius:18px;padding:22px;box-shadow:0 30px 60px rgba(0,0,0,.35)}
.header{display:flex;justify-content:space-between;align-items:center;gap:10px}
.brand{display:flex;align-items:center;gap:8px;font-weight:800}
.timer{font-weight:800;color:#ef4444}
.progress{height:10px;background:#e5e7eb;border-radius:999px;overflow:hidden;margin:14px 0}
.bar{height:100%;width:0%;background:linear-gradient(90deg,#7c7cff,#22d3ee);transition:.3s}
.q-meta{display:flex;justify-content:space-between;font-weight:700}
.question{font-size:20px;margin:12px 0}
.options{display:grid;gap:10px}
.opt{border:2px solid #e5e7eb;border-radius:12px;padding:12px;cursor:pointer;background:#fff;transition:.15s}
.opt:hover{transform:translateY(-1px);box-shadow:0 10px 18px rgba(0,0,0,.08)}
.correct{border-color:var(--ok);background:#ecfdf5}
.wrong{border-color:var(--bad);background:#fef2f2}
.footer{display:flex;justify-content:space-between;align-items:center;margin-top:14px}
.btn{border:none;border-radius:10px;padding:10px 16px;font-weight:800;background:#7c7cff;color:#fff;cursor:pointer}
.btn:disabled{background:#c7c7ff;cursor:not-allowed}
.center{text-align:center}
.big{font-size:42px;font-weight:900}
.pill{padding:6px 10px;border-radius:999px;color:#fff;font-weight:700;font-size:12px}
.quant{background:var(--quant)} .logic{background:var(--logic)} .di{background:var(--di)}
</style>
</head>
<body>

<div class="card">

<div id="start" class="center">
  <h1>üß† Smart Aptitude Quiz</h1>
  <p>25 Questions ‚Ä¢ 60s per question ‚Ä¢ Instant Feedback</p>
  <button class="btn" onclick="startQuiz()">üöÄ Start Quiz</button>
</div>

<div id="quiz" style="display:none">
  <div class="header">
    <div class="brand">üß† Smart Aptitude</div>
    <div id="topicPill" class="pill quant">üìê Quant</div>
    <div class="timer">‚è±Ô∏è <span id="timer">60</span>s</div>
  </div>

  <div class="progress"><div id="bar" class="bar"></div></div>

  <div class="q-meta">
    <div id="qCount">Q 1 / 25</div>
    <div>Score: <span id="score">0</span></div>
  </div>

  <div id="question" class="question"></div>
  <div id="options" class="options"></div>

  <div class="footer">
    <div></div>
    <button id="nextBtn" class="btn" onclick="nextQ()" disabled>Next ‚û°Ô∏è</button>
  </div>
</div>

<div id="result" class="center" style="display:none">
  <h2>üéâ Quiz Completed!</h2>
  <div class="big"><span id="finalScore"></span> / 25</div>
</div>

</div>

<script>
// redirect if participant not logged in
if (!localStorage.getItem("participant")) {
  window.location = "register.html";
}

// quiz questions
const quizData = [
  {t:"quant",q:"A trader buys 40 bags of rice at ‚Çπ1200 per bag and spends ‚Çπ2000 on transport. He sells each bag at ‚Çπ1400. What is his total profit?",o:["4000","5000","6000","7000"],a:"6000"},
  {t:"quant",q:"15 men can complete a job in 20 days working 6 hours per day. How many men are required to complete it in 10 days working 8 hours per day?",o:["20","22","23","25"],a:"23"},
  {t:"quant",q:"A sum becomes ‚Çπ5400 in 2 years and ‚Çπ6600 in 4 years at simple interest. What is the principal?",o:["4200","4400","4600","4800"],a:"4200"},
  {t:"quant",q:"Find the compound interest on ‚Çπ10,000 at 10% per annum for 2 years.",o:["2000","2100","2200","2400"],a:"2100"},
  {t:"quant",q:"The average marks of 30 students is 65. After including teacher marks, the average becomes 66. What are the teacher's marks?",o:["86","90","96","100"],a:"96"},
  {t:"quant",q:"A father is 4 times as old as his son. After 15 years, he will be twice the age of his son. What is the son's present age?",o:["10","12","15","18"],a:"15"},
  {t:"quant",q:"A train travels 300 km at 50 km/hr and returns at 75 km/hr. What is the average speed?",o:["55","60","62","65"],a:"60"},
  {t:"quant",q:"Milk and water are mixed in ratio 5:3 in a 64 litre container. How much milk is present?",o:["32","36","40","44"],a:"40"},
  {t:"quant",q:"A invests ‚Çπ20,000 for 1 year and B invests ‚Çπ30,000 for 8 months. If total profit is ‚Çπ18,000, what is A's share?",o:["8000","9000","10000","11000"],a:"9000"},
  {t:"quant",q:"Two dice are thrown. What is the probability that the sum is 8?",o:["5/36","1/6","1/8","7/36"],a:"5/36"},
  {t:"logic",q:"A boat moves downstream at 18 km/hr and upstream at 10 km/hr. What is the speed of the boat in still water?",o:["12","13","14","15"],a:"14"},
  {t:"logic",q:"A salary increases from ‚Çπ20,000 to ‚Çπ25,000. What is the percentage increase?",o:["20%","22%","25%","30%"],a:"25%"},
  {t:"logic",q:"A man walks at 5 km/hr and reaches 20 minutes late. At 6 km/hr he is 10 minutes early. What is the distance?",o:["8","9","10","12"],a:"10"},
  {t:"logic",q:"Pipe A fills a tank in 6 hours and Pipe B in 8 hours. How long will both together take?",o:["3.2","3.43","4","4.5"],a:"3.43"},
  {t:"logic",q:"Cost price is ‚Çπ800 and selling price is ‚Çπ920. What is the profit percentage?",o:["10%","12%","15%","18%"],a:"15%"},
  {t:"logic",q:"Average age of 5 persons is 30 years. One leaves and average becomes 28. What is the age of the person who left?",o:["35","36","38","40"],a:"38"},
  {t:"logic",q:"The sum of two numbers is 100 and their difference is 20. What is the larger number?",o:["40","50","60","70"],a:"60"},
  {t:"logic",q:"A train 120 m long crosses a pole in 6 seconds. What is its speed?",o:["60","72","80","90"],a:"72"},
  {t:"logic",q:"Marked price is ‚Çπ500 and it is sold for ‚Çπ450. What is the loss percentage?",o:["5%","8%","10%","12%"],a:"10%"},
  {t:"logic",q:"‚Çπ5000 becomes ‚Çπ6500 at 10% simple interest. What is the time?",o:["2","3","4","5"],a:"3"},
  {t:"di",q:"A can do a piece of work in 12 days and B in 18 days. How long will they take together?",o:["6","7.2","8","9"],a:"7.2"},
  {t:"di",q:"Divide ‚Çπ840 in the ratio 2:3:4. What is the largest share?",o:["280","300","320","373.33"],a:"373.33"},
  {t:"di",q:"What is the angle between clock hands at 3:30?",o:["60¬∞","75¬∞","90¬∞","105¬∞"],a:"75¬∞"},
  {t:"di",q:"A card is drawn from a deck. What is the probability of getting a heart?",o:["1/2","1/3","1/4","1/13"],a:"1/4"},
  {t:"di",q:"A container has 40 litres solution. 10 litres removed and replaced twice. How much original solution remains?",o:["20","22.5","25","30"],a:"22.5"}
];

let i = 0, score = 0, time = 60, timer;

// shuffle array
const shuffle = a => {for (let j=a.length-1;j>0;j--){const k=Math.floor(Math.random()*(j+1));[a[j],a[k]]=[a[k],a[j]]}}

// Restore quiz state if page refreshed for current participant only
const savedState = localStorage.getItem("quizState");
if(savedState) {
  const state = JSON.parse(savedState);
  if(state.participant_no && state.participant_no === localStorage.getItem("participant_no")){
    i = state.i; score = state.score; time = state.time;
    document.getElementById("start").style.display="none";
    document.getElementById("quiz").style.display="block";
    loadQ(true);
  } else {
    localStorage.removeItem("quizState");
    localStorage.removeItem("answers");
  }
}

function startQuiz(){
  shuffle(quizData);
  // clear previous state if any
  localStorage.removeItem("quizState");
  localStorage.removeItem("answers");
  
  document.getElementById("start").style.display="none";
  document.getElementById("quiz").style.display="block";
  loadQ(false);
}

function startTimer(){
  clearInterval(timer);
  timer = setInterval(()=>{
    document.getElementById("timer").textContent = --time;
    saveState();
    if(time<=0) nextQ();
  },1000);
}

function loadQ(resume=false){
  if(!resume) time=60;
  startTimer();

  const q = quizData[i];
  document.getElementById("qCount").textContent=`Q ${i+1} / 25`;
  document.getElementById("question").textContent = q.q;
  document.getElementById("bar").style.width=((i+1)/25*100)+"%";

  const pill = document.getElementById("topicPill");
  pill.className = "pill "+q.t;
  pill.textContent = q.t==="quant"?"üìê Quant":q.t==="logic"?"üß© Logic":"üìä DI";

  const opts = [...q.o]; shuffle(opts);
  const box = document.getElementById("options");
  box.innerHTML="";
  opts.forEach(v=>{
    const d=document.createElement("div");
    d.className="opt";
    d.textContent = v;
    d.onclick = ()=>answer(d,v,q.a);
    box.appendChild(d);
  });

  document.getElementById("nextBtn").disabled=true;

  if(resume && localStorage.getItem("answers")){
    const answers = JSON.parse(localStorage.getItem("answers"));
    if(answers[i]){
      document.querySelectorAll(".opt").forEach(o=>{
        o.style.pointerEvents="none";
        if(o.textContent === answers[i].correct) o.classList.add("correct");
        if(o.textContent === answers[i].selected && answers[i].selected!==answers[i].correct) o.classList.add("wrong");
      });
      document.getElementById("score").textContent=score;
      document.getElementById("nextBtn").disabled=false;
    }
  }
}

function answer(el,val,correct){
  document.querySelectorAll(".opt").forEach(o=>o.style.pointerEvents="none");
  if(val===correct){el.classList.add("correct"); score++;}
  else{
    el.classList.add("wrong");
    document.querySelectorAll(".opt").forEach(o=>{
      if(o.textContent===correct) o.classList.add("correct");
    });
  }
  document.getElementById("score").textContent=score;
  document.getElementById("nextBtn").disabled=false;

  let answers = localStorage.getItem("answers") ? JSON.parse(localStorage.getItem("answers")) : [];
  answers[i] = { selected: val, correct: correct };
  localStorage.setItem("answers", JSON.stringify(answers));
  saveState();
}

function nextQ(){
  clearInterval(timer);
  i++;
  if(i<25) loadQ(false);
  else finish();
  saveState();
}

function saveState(){
  const participant_no = localStorage.getItem("participant_no");
  localStorage.setItem("quizState", JSON.stringify({i,score,time, participant_no}));
}

function finish(){
  clearInterval(timer);
  document.getElementById("quiz").style.display="none";
  document.getElementById("result").style.display="block";
  document.getElementById("finalScore").textContent = score;

  const participant_no = localStorage.getItem("participant_no");
  fetch("/api/submit-score",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({score,participant_no})
  })
  .then(res=>res.json())
  .then(data=>console.log("Score saved:",data))
  .catch(err=>console.error("Error saving score:",err));

  localStorage.setItem("finalScore",score);
  localStorage.removeItem("quizState");
  localStorage.removeItem("answers");
}
</script>

</body>
</html>